<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="../favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="../favicon-32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../favicon-16.png">
  <link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
  <title>BMRI 指标 — Crypto3D</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&family=Noto+Sans+SC:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../indicators/css/common.css">
  <script src="https://unpkg.com/lightweight-charts@4/dist/lightweight-charts.standalone.production.js"></script>
  <script src="../indicators/js/chart-utils.js"></script>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <a href="../" class="logo">
          <img src="../logo.svg" alt="3D" class="logo-icon">
          <span class="logo-text">Crypto3D</span>
        </a>
        <div class="nav-links">
          <a href="../" data-zh="首页" data-en="Home">首页</a>
          <a href="../tev/" data-zh="TEV" data-en="TEV">TEV</a>
          <a href="../ahr999/">AHR999</a>
          <div class="lang-switch" onclick="LangUtils.toggle(); updateDisplay();">
            <span id="lang-zh" class="active">中文</span>
            <span>/</span>
            <span id="lang-en">EN</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <!-- Loading State -->
      <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div data-zh="加载 BMRI 数据中..." data-en="Loading BMRI data...">加载 BMRI 数据中...</div>
      </div>

      <!-- Main Content (hidden until data loads) -->
      <div id="content" style="display: none;">
      <div class="page-header">
        <h1 class="page-title">BMRI <span data-zh="宏观风险指标" data-en="Macro Risk Index">宏观风险指标</span></h1>
        <p class="page-subtitle" data-zh="Bitcoin Macro Risk Index — 综合利率、流动性、风险偏好的宏观环境评估" data-en="Bitcoin Macro Risk Index — Rates, Liquidity, and Risk Appetite assessment">Bitcoin Macro Risk Index — 综合利率、流动性、风险偏好的宏观环境评估</p>
      </div>

      <!-- Version Tabs -->
      <div class="version-tabs">
        <div class="version-tab active" data-version="6m" onclick="switchVersion('6m')">
          <div>6M <span data-zh="版" data-en="Version">版</span></div>
          <div class="version-desc" data-zh="中周期趋势，1-6月调仓" data-en="Medium-term, 1-6 month rebalancing">中周期趋势，1-6月调仓</div>
        </div>
        <div class="version-tab" data-version="1m" onclick="switchVersion('1m')">
          <div>1M <span data-zh="版" data-en="Version">版</span></div>
          <div class="version-desc" data-zh="短期冲击，1-4周调仓" data-en="Short-term, 1-4 week rebalancing">短期冲击，1-4周调仓</div>
        </div>
      </div>

      <!-- Main Stats -->
      <div class="stats-grid">
        <div class="stat-card main">
          <div class="stat-label">BMRI</div>
          <div class="stat-value" id="bmri-value">—</div>
          <div class="stat-hint" id="bmri-regime">—</div>
        </div>
        <div class="stat-card">
          <div class="stat-label" data-zh="市场状态" data-en="Market State">市场状态</div>
          <div class="stat-value" id="market-state" style="font-size: 18px;">—</div>
          <div class="stat-hint" id="regime-hint">—</div>
          <div class="stat-hint" id="update-date" style="color: var(--text-tertiary); font-size: 11px;">—</div>
        </div>
      </div>

      <!-- Bucket Stats -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-label">Rates <span data-zh="利率" data-en="">(利率)</span></div>
          <div class="bucket-value" id="rates-value">—</div>
          <div class="bucket-bar"><div class="bucket-fill" id="rates-bar" style="width: 50%;"></div></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Liquidity <span data-zh="流动性" data-en="">(流动性)</span></div>
          <div class="bucket-value" id="liq-value">—</div>
          <div class="bucket-bar"><div class="bucket-fill" id="liq-bar" style="width: 50%;"></div></div>
        </div>
        <div class="stat-card">
          <div class="stat-label">Risk <span data-zh="风险偏好" data-en="">(风险偏好)</span></div>
          <div class="bucket-value" id="risk-value">—</div>
          <div class="bucket-bar"><div class="bucket-fill" id="risk-bar" style="width: 50%;"></div></div>
        </div>
      </div>

      <!-- Zone Legend -->
      <div class="zone-legend">
        <div class="zone-item">
          <div class="zone-dot risk-on"></div>
          <span id="threshold-on">> +0.6 Risk-On</span>
        </div>
        <div class="zone-item">
          <div class="zone-dot neutral"></div>
          <span data-zh="中性区间" data-en="Neutral Zone">中性区间</span>
        </div>
        <div class="zone-item">
          <div class="zone-dot risk-off"></div>
          <span id="threshold-off">< -0.6 Risk-Off</span>
        </div>
      </div>

      <!-- Chart -->
      <div class="chart-container">
        <div class="chart-header">
          <div class="chart-title" data-zh="BMRI 历史走势" data-en="BMRI History">BMRI 历史走势</div>
          <div class="chart-legend">
            <div class="legend-item fixed"><div class="legend-line dashed" style="color: #22c55e;"></div><span id="legend-on">+0.6</span></div>
            <div class="legend-item fixed"><div class="legend-line dashed" style="color: #ef4444;"></div><span id="legend-off">-0.6</span></div>
            <div class="legend-item" data-series="bmri" onclick="toggleSeries('bmri')"><div class="legend-line" style="background: #3b82f6;"></div><span>BMRI</span></div>
            <div class="legend-item disabled" data-series="rates" onclick="toggleSeries('rates')"><div class="legend-line" style="background: #06b6d4;"></div><span>Rates</span></div>
            <div class="legend-item disabled" data-series="liq" onclick="toggleSeries('liq')"><div class="legend-line" style="background: #22c55e;"></div><span>Liquidity</span></div>
            <div class="legend-item disabled" data-series="risk" onclick="toggleSeries('risk')"><div class="legend-line" style="background: #f59e0b;"></div><span>Risk</span></div>
            <div class="legend-item disabled" data-series="btcMcap" onclick="toggleSeries('btcMcap')"><div class="legend-line" style="background: #f7931a;"></div><span data-zh="BTC市值" data-en="BTC MCap">BTC市值</span></div>
            <div class="legend-item disabled" data-series="totalMcap" onclick="toggleSeries('totalMcap')"><div class="legend-line" style="background: #8b5cf6;"></div><span data-zh="总市值" data-en="Total MCap">总市值</span></div>
          </div>
        </div>
        <div class="chart-wrapper" id="chart-container"></div>
        <div class="chart-tooltip floating" id="chart-tooltip">
          <div class="tooltip-date" id="tooltip-date">—</div>
          <div class="tooltip-item" id="tooltip-bmri"><div class="tooltip-dot" style="background: #3b82f6;"></div><span class="tooltip-label">BMRI:</span><span class="tooltip-value" id="tooltip-bmri-value">—</span></div>
          <div class="tooltip-item" id="tooltip-rates" style="display:none;"><div class="tooltip-dot" style="background: #06b6d4;"></div><span class="tooltip-label">Rates:</span><span class="tooltip-value" id="tooltip-rates-value">—</span></div>
          <div class="tooltip-item" id="tooltip-liq" style="display:none;"><div class="tooltip-dot" style="background: #22c55e;"></div><span class="tooltip-label">Liq:</span><span class="tooltip-value" id="tooltip-liq-value">—</span></div>
          <div class="tooltip-item" id="tooltip-risk" style="display:none;"><div class="tooltip-dot" style="background: #f59e0b;"></div><span class="tooltip-label">Risk:</span><span class="tooltip-value" id="tooltip-risk-value">—</span></div>
          <div class="tooltip-item" id="tooltip-btcMcap" style="display:none;"><div class="tooltip-dot" style="background: #f7931a;"></div><span class="tooltip-label">BTC:</span><span class="tooltip-value" id="tooltip-btcMcap-value">—</span></div>
          <div class="tooltip-item" id="tooltip-totalMcap" style="display:none;"><div class="tooltip-dot" style="background: #8b5cf6;"></div><span class="tooltip-label">Total:</span><span class="tooltip-value" id="tooltip-totalMcap-value">—</span></div>
        </div>
        <div class="chart-hint" data-zh="💡 拖动平移 · 滚轮缩放 · 双击重置" data-en="💡 Drag to pan · Scroll to zoom · Double-click to reset">💡 拖动平移 · 滚轮缩放 · 双击重置</div>
        <div class="data-update-time" id="data-update-time">—</div>
      </div>

      <!-- Info Sections -->
      <div class="info-section">
        <h2 class="info-title" data-zh="💡 什么是 BMRI？" data-en="💡 What is BMRI?">💡 什么是 BMRI？</h2>
        <div class="info-text">
          <p data-zh="BMRI（Bitcoin Macro Risk Index）是一个宏观风险评估指标，帮助你判断「现在的宏观环境对比特币是友好还是不友好」。" data-en="BMRI (Bitcoin Macro Risk Index) is a macro risk indicator that helps you determine whether the current macro environment is favorable or unfavorable for Bitcoin.">BMRI（Bitcoin Macro Risk Index）是一个宏观风险评估指标，帮助你判断「现在的宏观环境对比特币是友好还是不友好」。</p>
          <p><strong>核心逻辑：</strong>比特币虽然常被称为「数字黄金」，但它本质上是一个风险资产。当全球流动性充裕、利率下降、市场风险偏好上升时，比特币往往表现更好；反之则承压。</p>
          <div style="background: var(--bg-tertiary); padding: 16px; border-radius: 8px; margin: 12px 0;">
            <p style="margin: 0 0 8px 0;">🟢 <strong>Risk-On</strong>：宏观环境友好，适合持有或加仓</p>
            <p style="margin: 0 0 8px 0;">🟡 <strong>Neutral</strong>：宏观环境中性，维持现有配置</p>
            <p style="margin: 0;">🔴 <strong>Risk-Off</strong>：宏观环境恶化，考虑减仓或对冲</p>
          </div>
        </div>
      </div>

      <div class="info-section">
        <h2 class="info-title" data-zh="📊 三大组成部分" data-en="📊 Three Components">📊 三大组成部分</h2>
        <div class="info-text">
          <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 12px; margin: 16px 0; border-left: 4px solid var(--blue);">
            <h3 style="font-size: 16px; margin-bottom: 12px; color: var(--blue);">📉 Rates 利率桶（权重 35%）</h3>
            <p style="margin-bottom: 8px;"><strong>监测什么：</strong>美国国债利率的变化方向</p>
            <p style="color: var(--text-tertiary); font-size: 13px;">数据来源：10年期美债名义利率 (DGS10)、10年期 TIPS 实际利率 (DFII10)</p>
          </div>
          <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 12px; margin: 16px 0; border-left: 4px solid var(--accent);">
            <h3 style="font-size: 16px; margin-bottom: 12px; color: var(--accent);">💧 Liquidity 流动性桶（权重 35%）</h3>
            <p style="margin-bottom: 8px;"><strong>监测什么：</strong>全球美元流动性的松紧程度</p>
            <p style="color: var(--text-tertiary); font-size: 13px;">数据来源：美元指数 (DXY)、美联储资产负债表 (WALCL)、隔夜逆回购 (RRP)</p>
          </div>
          <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 12px; margin: 16px 0; border-left: 4px solid var(--warning);">
            <h3 style="font-size: 16px; margin-bottom: 12px; color: var(--warning);">⚡ Risk 风险偏好桶（权重 30%）</h3>
            <p style="margin-bottom: 8px;"><strong>监测什么：</strong>市场的恐慌程度和信用风险</p>
            <p style="color: var(--text-tertiary); font-size: 13px;">数据来源：VIX 恐慌指数 (VIXCLS)、高收益债信用利差 (HY OAS)</p>
          </div>
        </div>
      </div>

      <div class="info-section">
        <h2 class="info-title" data-zh="🔄 1M 版 vs 6M 版" data-en="🔄 1M vs 6M Version">🔄 1M 版 vs 6M 版</h2>
        <div class="info-text">
          <table class="info-table">
            <thead><tr><th></th><th>6M 版（推荐）</th><th>1M 版</th></tr></thead>
            <tbody>
              <tr><td style="font-weight: 500;">适用周期</td><td>1-6 个月调仓</td><td>1-4 周调仓</td></tr>
              <tr><td style="font-weight: 500;">信号特点</td><td>更稳定，过滤噪音</td><td>更敏感，快速响应</td></tr>
              <tr><td style="font-weight: 500;">阈值</td><td>±0.6</td><td>±0.5</td></tr>
            </tbody>
          </table>
          <div class="disclaimer">💡 <strong>建议：</strong>大多数投资者使用 6M 版作为主要参考。如果你需要更及时的短期预警，可以叠加参考 1M 版。</div>
        </div>
      </div>
      </div><!-- end content -->
    </div>
  </main>

  <footer>
    <div class="container">
      <p class="footer-text">© 2026 Crypto3D</p>
    </div>
  </footer>

  <script>
    // === State ===
    let currentVersion = '6m';
    let bmriData = null;
    let mcapData = null;
    let chart = null;
    let series = {};
    let zones = {};
    let seriesVisible = { bmri: true, rates: false, liq: false, risk: false, btcMcap: false, totalMcap: false };
    let defaultRange = null;
    let historyData = {};
    let currentThresholds = { on: 0.6, off: -0.6 };

    // === Regime Logic ===
    function getRegimeInfo(regime) {
      const lang = LangUtils.get();
      if (regime === 'RISK_ON') {
        return { class: 'risk-on', label: lang === 'zh' ? '风险开启' : 'Risk-On', state: '🟢 Risk-On', hint: lang === 'zh' ? '宏观环境友好，适合持有或加仓' : 'Favorable macro, hold or add' };
      } else if (regime === 'RISK_OFF') {
        return { class: 'risk-off', label: lang === 'zh' ? '风险关闭' : 'Risk-Off', state: '🔴 Risk-Off', hint: lang === 'zh' ? '宏观环境恶化，考虑减仓或对冲' : 'Unfavorable macro, reduce or hedge' };
      }
      return { class: 'neutral', label: lang === 'zh' ? '中性' : 'Neutral', state: '🟡 Neutral', hint: lang === 'zh' ? '宏观环境中性，维持现有配置' : 'Neutral macro, maintain position' };
    }

    function updateBucketBar(id, value) {
      const bar = document.getElementById(id);
      if (!bar || value === null) return;
      const percent = Math.min(100, Math.max(0, (value + 1) * 50)); // -1~1 -> 0~100
      bar.style.width = percent + '%';
      bar.className = 'bucket-fill ' + (value >= 0 ? 'positive' : 'negative');
    }

    // === Version Switch ===
    function switchVersion(version) {
      currentVersion = version;
      document.querySelectorAll('.version-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.version === version);
      });
      if (bmriData) updateDisplay();
    }

    // === Chart Controls ===
    function toggleSeries(name) {
      toggleSeriesVisibility(series, seriesVisible, name, { bmri: zones });
      const el = document.getElementById(`tooltip-${name}`);
      if (el) el.style.display = seriesVisible[name] ? 'flex' : 'none';
    }

    function resetChart() {
      if (chart && defaultRange) chart.timeScale().setVisibleRange(defaultRange);
    }

    // === Display Update ===
    function updateDisplay() {
      if (!bmriData) return;
      const versionData = bmriData[currentVersion];
      const current = versionData.current;
      const thresholds = versionData.thresholds;
      currentThresholds = thresholds;
      const regimeInfo = getRegimeInfo(current.regime);

      document.getElementById('bmri-value').textContent = current.value.toFixed(1);
      document.getElementById('bmri-value').className = `stat-value ${regimeInfo.class}`;
      document.getElementById('bmri-regime').textContent = regimeInfo.label;
      document.getElementById('market-state').textContent = regimeInfo.state;
      document.getElementById('regime-hint').textContent = regimeInfo.hint;
      document.getElementById('update-date').textContent = current.date;

      document.getElementById('rates-value').textContent = current.rates !== null ? current.rates.toFixed(2) : '—';
      document.getElementById('liq-value').textContent = current.liq !== null ? current.liq.toFixed(2) : '—';
      document.getElementById('risk-value').textContent = current.risk !== null ? current.risk.toFixed(2) : '—';

      updateBucketBar('rates-bar', current.rates);
      updateBucketBar('liq-bar', current.liq);
      updateBucketBar('risk-bar', current.risk);

      document.getElementById('threshold-on').textContent = `> ${thresholds.on} Risk-On`;
      document.getElementById('threshold-off').textContent = `< ${thresholds.off} Risk-Off`;
      document.getElementById('legend-on').textContent = `${thresholds.on}`;
      document.getElementById('legend-off').textContent = `${thresholds.off}`;

      if (bmriData.updated_at) {
        const prefix = LangUtils.get() === 'zh' ? '数据更新: ' : 'Data updated: ';
        document.getElementById('data-update-time').textContent = prefix + bmriData.updated_at;
      }

      drawChart(versionData.history, thresholds);
    }

    // === Data Loading ===
    async function loadData() {
      try {
        const [bmriRes, mcapRes] = await Promise.all([
          fetch('../indicators/data/bmri.json'),
          fetch('../indicators/data/mcap.json').catch(() => null)
        ]);
        bmriData = await bmriRes.json();
        if (mcapRes) mcapData = await mcapRes.json();
        
        // Hide loading, show content
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';
        
        updateDisplay();
      } catch (err) {
        console.error('Failed to load data:', err);
        document.getElementById('loading').innerHTML = '<div style="color: var(--danger);">加载失败</div>';
      }
    }

    // === Chart Drawing ===
    function drawChart(history, thresholds) {
      if (chart) { chart.remove(); chart = null; series = {}; zones = {}; }

      chart = createChart('chart-container', {
        leftPriceScale: { visible: true, mode: LightweightCharts.PriceScaleMode.Logarithmic },
      });

      // Prepare data
      const bmriDataArr = history.map(d => ({ time: d.date, value: d.bmri }));
      const ratesDataArr = history.filter(d => d.rates !== null).map(d => ({ time: d.date, value: d.rates }));
      const liqDataArr = history.filter(d => d.liq !== null).map(d => ({ time: d.date, value: d.liq }));
      const riskDataArr = history.filter(d => d.risk !== null).map(d => ({ time: d.date, value: d.risk }));
      historyData = buildHistoryLookup(history);
      const lastDate = history[history.length - 1].date;

      // Zone backgrounds
      zones.green = createZoneSeries(chart, thresholds.on, { bottomFill1: 'rgba(34, 197, 94, 0.08)', bottomFill2: 'rgba(34, 197, 94, 0.25)' });
      zones.green.setData(bmriDataArr);
      zones.red = createZoneSeries(chart, thresholds.off, { topFill1: 'rgba(239, 68, 68, 0.08)', topFill2: 'rgba(239, 68, 68, 0.25)' });
      zones.red.setData(bmriDataArr);

      // BMRI Series
      const bmriWithWhitespace = addFutureWhitespace(bmriDataArr, lastDate, 90);
      series.bmri = chart.addLineSeries({ color: '#3b82f6', lineWidth: 2, priceScaleId: 'right', priceFormat: { type: 'price', precision: 1, minMove: 0.1 }, lastValueVisible: false, priceLineVisible: false });
      series.bmri.setData(bmriWithWhitespace);

      createThresholdLine(series.bmri, thresholds.on, '#22c55e');
      createThresholdLine(series.bmri, thresholds.off, '#ef4444');
      createThresholdLine(series.bmri, 0, 'rgba(161, 161, 170, 0.3)', { axisLabelVisible: false });

      // Bucket series (hidden)
      series.rates = chart.addLineSeries({ color: '#06b6d4', lineWidth: 1.5, priceScaleId: 'right', priceFormat: { type: 'price', precision: 2, minMove: 0.01 }, lastValueVisible: false, priceLineVisible: false, visible: false });
      series.rates.setData(ratesDataArr);

      series.liq = chart.addLineSeries({ color: '#22c55e', lineWidth: 1.5, priceScaleId: 'right', priceFormat: { type: 'price', precision: 2, minMove: 0.01 }, lastValueVisible: false, priceLineVisible: false, visible: false });
      series.liq.setData(liqDataArr);

      series.risk = chart.addLineSeries({ color: '#f59e0b', lineWidth: 1.5, priceScaleId: 'right', priceFormat: { type: 'price', precision: 2, minMove: 0.01 }, lastValueVisible: false, priceLineVisible: false, visible: false });
      series.risk.setData(riskDataArr);

      // Market cap series (if available)
      if (mcapData) {
        const btcMcapData = mcapData.history.filter(d => d.btc_mcap).map(d => ({ time: d.date, value: d.btc_mcap }));
        const totalMcapData = mcapData.history.filter(d => d.total_mcap).map(d => ({ time: d.date, value: d.total_mcap }));
        
        series.btcMcap = chart.addLineSeries({ color: '#f7931a', lineWidth: 1.5, priceScaleId: 'left', priceFormat: { type: 'price', precision: 0, minMove: 1e9 }, lastValueVisible: false, priceLineVisible: false, visible: false });
        series.btcMcap.setData(btcMcapData);
        
        series.totalMcap = chart.addLineSeries({ color: '#8b5cf6', lineWidth: 1.5, priceScaleId: 'left', priceFormat: { type: 'price', precision: 0, minMove: 1e9 }, lastValueVisible: false, priceLineVisible: false, visible: false });
        series.totalMcap.setData(totalMcapData);
      }

      // Default range
      defaultRange = setDefaultRange(chart, '2017-08-01', lastDate);

      // Double-click reset
      document.getElementById('chart-container').addEventListener('dblclick', resetChart);

      // Tooltip
      const tooltip = document.getElementById('chart-tooltip');
      chart.subscribeCrosshairMove(param => {
        if (!param.time || !param.point || param.point.x < 0) { tooltip.classList.remove('visible'); return; }
        tooltip.classList.add('visible');
        document.getElementById('tooltip-date').textContent = formatTime(param.time);
        
        const dateStr = typeof param.time === 'string' ? param.time : `${param.time.year}-${String(param.time.month).padStart(2,'0')}-${String(param.time.day).padStart(2,'0')}`;
        const d = historyData[dateStr];
        const mc = mcapData?.history.find(m => m.date === dateStr);

        if (seriesVisible.bmri && d?.bmri !== undefined) { document.getElementById('tooltip-bmri').style.display = 'flex'; document.getElementById('tooltip-bmri-value').textContent = d.bmri.toFixed(1); } else { document.getElementById('tooltip-bmri').style.display = 'none'; }
        if (seriesVisible.rates && d?.rates !== undefined) { document.getElementById('tooltip-rates').style.display = 'flex'; document.getElementById('tooltip-rates-value').textContent = d.rates.toFixed(2); } else { document.getElementById('tooltip-rates').style.display = 'none'; }
        if (seriesVisible.liq && d?.liq !== undefined) { document.getElementById('tooltip-liq').style.display = 'flex'; document.getElementById('tooltip-liq-value').textContent = d.liq.toFixed(2); } else { document.getElementById('tooltip-liq').style.display = 'none'; }
        if (seriesVisible.risk && d?.risk !== undefined) { document.getElementById('tooltip-risk').style.display = 'flex'; document.getElementById('tooltip-risk-value').textContent = d.risk.toFixed(2); } else { document.getElementById('tooltip-risk').style.display = 'none'; }
        if (seriesVisible.btcMcap && mc?.btc_mcap) { document.getElementById('tooltip-btcMcap').style.display = 'flex'; document.getElementById('tooltip-btcMcap-value').textContent = formatMarketCap(mc.btc_mcap); } else { document.getElementById('tooltip-btcMcap').style.display = 'none'; }
        if (seriesVisible.totalMcap && mc?.total_mcap) { document.getElementById('tooltip-totalMcap').style.display = 'flex'; document.getElementById('tooltip-totalMcap-value').textContent = formatMarketCap(mc.total_mcap); } else { document.getElementById('tooltip-totalMcap').style.display = 'none'; }
      });
    }

    // === Init ===
    document.addEventListener('DOMContentLoaded', () => {
      LangUtils.init();
      loadData();
    });
  </script>
</body>
</html>
