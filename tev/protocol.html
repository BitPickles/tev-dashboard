<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Protocol ‚Äî TEV Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg-primary: #0a0a0b;
      --bg-secondary: #111113;
      --bg-tertiary: #18181b;
      --bg-hover: #1f1f23;
      --border: #27272a;
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-tertiary: #71717a;
      --accent: #22c55e;
      --accent-dim: rgba(34, 197, 94, 0.15);
      --red: #ef4444;
      --red-dim: rgba(239, 68, 68, 0.15);
      --blue: #3b82f6;
      --blue-dim: rgba(59, 130, 246, 0.15);
      --warning: #f59e0b;
      --warning-dim: rgba(245, 158, 11, 0.15);
      --purple: #a855f7;
      --purple-dim: rgba(168, 85, 247, 0.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', -apple-system, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

    header {
      border-bottom: 1px solid var(--border);
      padding: 16px 0;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: inherit;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      background: var(--accent);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      color: var(--bg-primary);
    }

    .logo-text {
      font-size: 18px;
      font-weight: 600;
    }

    .logo-text span {
      color: var(--text-tertiary);
      font-weight: 400;
    }

    .lang-switch {
      display: flex;
      gap: 4px;
      background: var(--bg-tertiary);
      padding: 4px;
      border-radius: 8px;
    }

    .lang-btn {
      padding: 6px 12px;
      border: none;
      background: transparent;
      color: var(--text-secondary);
      font-size: 13px;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .lang-btn.active {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .breadcrumb {
      padding: 20px 0;
      font-size: 14px;
      color: var(--text-tertiary);
    }

    .breadcrumb a {
      color: var(--text-secondary);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      color: var(--text-primary);
    }

    .protocol-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding-bottom: 32px;
      flex-wrap: wrap;
      gap: 24px;
    }

    .protocol-title {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .protocol-icon {
      width: 64px;
      height: 64px;
      border-radius: 16px;
      background: var(--bg-tertiary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      overflow: hidden;
    }

    .protocol-icon img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .protocol-info h1 {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .protocol-ticker {
      font-size: 14px;
      color: var(--text-tertiary);
      margin-top: 4px;
    }

    .protocol-badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-active { background: var(--accent-dim); color: var(--accent); }
    .badge-partial { background: var(--warning-dim); color: var(--warning); }
    .badge-none { background: var(--red-dim); color: var(--red); }
    .badge-planned { background: var(--blue-dim); color: var(--blue); }

    .protocol-links {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .protocol-link {
      padding: 6px 12px;
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 13px;
      transition: all 0.2s;
    }

    .protocol-link:hover {
      border-color: var(--text-tertiary);
      color: var(--text-primary);
    }

    .tev-highlight {
      text-align: right;
      min-width: 200px;
    }

    .tev-status {
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 4px;
    }

    .tev-status.active { color: var(--accent); }
    .tev-status.none { color: var(--red); }
    .tev-status.partial { color: var(--warning); }

    .tev-value {
      font-size: 32px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
    }

    .tev-label {
      font-size: 13px;
      color: var(--text-tertiary);
      margin-top: 4px;
    }

    .section {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .section-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .section-title .icon {
      font-size: 18px;
    }

    /* TEV Summary */
    .tev-summary-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 12px;
    }

    .tev-summary-item {
      background: var(--bg-tertiary);
      padding: 16px;
      border-radius: 8px;
      text-align: center;
    }

    .tev-summary-label {
      font-size: 11px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 8px;
    }

    .tev-summary-value {
      font-size: 14px;
      font-weight: 600;
    }

    .value-on { color: var(--accent); }
    .value-off { color: var(--red); }
    .value-partial { color: var(--warning); }
    .value-none { color: var(--text-tertiary); }
    .value-active { color: var(--accent); }

    /* TEV History Chart */
    .chart-section {
      display: none;
    }

    .chart-section.has-data {
      display: block;
    }

    .chart-container {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      position: relative;
    }

    .chart-canvas-wrap {
      position: relative;
      height: 360px;
    }

    .chart-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .chart-stat {
      text-align: center;
    }

    .chart-stat-value {
      font-size: 18px;
      font-weight: 700;
      font-family: 'JetBrains Mono', 'Inter', monospace;
      color: var(--accent);
    }

    .chart-stat-label {
      font-size: 11px;
      color: var(--text-tertiary);
      margin-top: 2px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    @media (max-width: 768px) {
      .chart-canvas-wrap {
        height: 260px;
      }
      .chart-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* TEV Mechanisms */
    .mechanism-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .mechanism-card {
      background: var(--bg-tertiary);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
    }

    .mechanism-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }

    .mechanism-name {
      font-size: 15px;
      font-weight: 600;
    }

    .mechanism-type {
      font-size: 11px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 2px;
    }

    .mechanism-status {
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 500;
      text-transform: uppercase;
    }

    .status-active { background: var(--accent-dim); color: var(--accent); }
    .status-planned { background: var(--blue-dim); color: var(--blue); }
    .status-inactive { background: var(--red-dim); color: var(--red); }

    .mechanism-desc {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
      margin-bottom: 12px;
    }

    .mechanism-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      font-size: 13px;
      color: var(--text-tertiary);
    }

    .mechanism-meta a {
      color: var(--blue);
      text-decoration: none;
    }

    .mechanism-meta a:hover {
      text-decoration: underline;
    }

    /* No TEV */
    .no-tev-notice {
      background: var(--red-dim);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 10px;
      padding: 24px;
      text-align: center;
    }

    .no-tev-notice .icon {
      font-size: 32px;
      margin-bottom: 12px;
    }

    .no-tev-notice h3 {
      color: var(--red);
      margin-bottom: 8px;
    }

    .no-tev-notice p {
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* Data Sources */
    .sources-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .source-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
    }

    .source-name {
      font-size: 14px;
      font-weight: 500;
    }

    .source-type {
      font-size: 11px;
      color: var(--text-tertiary);
      text-transform: uppercase;
      margin-left: 8px;
    }

    .source-link {
      color: var(--blue);
      text-decoration: none;
      font-size: 13px;
    }

    .source-link:hover {
      text-decoration: underline;
    }

    /* Notes */
    .protocol-notes {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.8;
      padding: 16px;
      background: var(--bg-tertiary);
      border-radius: 8px;
      border-left: 3px solid var(--accent);
    }

    /* BNB Burns Section */
    .burn-progress-container {
      background: var(--bg-tertiary);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 24px;
    }

    .burn-progress-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .burn-progress-bar {
      height: 24px;
      background: var(--bg-hover);
      border-radius: 12px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .burn-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #f0b90b 0%, #f8d12f 100%);
      border-radius: 12px;
      transition: width 0.5s ease;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding-right: 12px;
      font-size: 12px;
      font-weight: 600;
      color: #000;
    }

    .burn-progress-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 16px;
      text-align: center;
    }

    .burn-stat-value {
      font-size: 20px;
      font-weight: 700;
      font-family: 'JetBrains Mono', monospace;
      color: var(--text-primary);
    }

    .burn-stat-label {
      font-size: 12px;
      color: var(--text-tertiary);
      margin-top: 4px;
    }

    .burn-charts-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }

    .burn-chart-card {
      background: var(--bg-tertiary);
      border-radius: 12px;
      padding: 20px;
    }

    .burn-chart-card h4 {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    @media (max-width: 768px) {
      .burn-charts-grid {
        grid-template-columns: 1fr;
      }
      .burn-progress-stats {
        grid-template-columns: 1fr;
        gap: 12px;
      }
    }

    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-tertiary);
    }

    .loading-spinner {
      width: 32px;
      height: 32px;
      border: 3px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 16px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    footer {
      padding: 24px 0;
      border-top: 1px solid var(--border);
      margin-top: 32px;
    }

    .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: var(--text-tertiary);
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      margin-left: 16px;
    }

    @media (max-width: 768px) {
      .protocol-header { flex-direction: column; }
      .tev-highlight { text-align: left; }
      .tev-summary-grid { grid-template-columns: repeat(2, 1fr); }
      .mechanism-header { flex-direction: column; gap: 8px; }
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="header-content">
        <a href="index.html" class="logo">
          <div class="logo-icon">T</div>
          <div class="logo-text">TEV <span>Dashboard</span></div>
        </a>
        <div class="lang-switch">
          <button class="lang-btn active" data-lang="zh">‰∏≠Êñá</button>
          <button class="lang-btn" data-lang="en">EN</button>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="breadcrumb">
      <a href="index.html" data-i18n="nav.dashboard">Dashboard</a> / <span id="breadcrumb-name">Loading...</span>
    </div>

    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <div data-i18n="loading">Âä†ËΩΩ‰∏≠...</div>
    </div>

    <div id="content" style="display: none;">
      <!-- Protocol Header -->
      <div class="protocol-header">
        <div class="protocol-title">
          <div class="protocol-icon" id="protocol-icon">üîÆ</div>
          <div class="protocol-info">
            <h1>
              <span id="protocol-name">Protocol</span>
              <span class="protocol-badge badge-active" id="tev-badge">TEV Active</span>
            </h1>
            <div class="protocol-ticker" id="protocol-ticker">TICKER ¬∑ Category</div>
            <div class="protocol-links">
              <a href="#" class="protocol-link" id="link-website" target="_blank">üåê Website</a>
              <a href="#" class="protocol-link" id="link-docs" target="_blank">üìÑ Docs</a>
              <a href="#" class="protocol-link" id="link-coingecko" target="_blank">ü¶é CoinGecko</a>
            </div>
          </div>
        </div>
        <div class="tev-highlight">
          <div class="tev-status active" id="tev-status-text">TEV ACTIVE</div>
          <div class="tev-value" id="primary-value">‚Äî</div>
          <div class="tev-label" id="primary-label">Primary Value Accrual</div>
        </div>
      </div>

      <!-- TEV Summary -->
      <div class="section">
        <div class="section-title">
          <span class="icon">üìä</span>
          <span data-i18n="section.tevSummary">TEV Ê¶ÇËßà</span>
        </div>
        <div class="tev-summary-grid">
          <div class="tev-summary-item">
            <div class="tev-summary-label" data-i18n="tev.feeSwitch">Fee Switch</div>
            <div class="tev-summary-value" id="summary-fee-switch">‚Äî</div>
          </div>
          <div class="tev-summary-item">
            <div class="tev-summary-label" data-i18n="tev.buybacks">Buybacks</div>
            <div class="tev-summary-value" id="summary-buybacks">‚Äî</div>
          </div>
          <div class="tev-summary-item">
            <div class="tev-summary-label" data-i18n="tev.dividends">Dividends</div>
            <div class="tev-summary-value" id="summary-dividends">‚Äî</div>
          </div>
          <div class="tev-summary-item">
            <div class="tev-summary-label" data-i18n="tev.burns">Burns</div>
            <div class="tev-summary-value" id="summary-burns">‚Äî</div>
          </div>
          <div class="tev-summary-item">
            <div class="tev-summary-label" data-i18n="tev.confidence">Confidence</div>
            <div class="tev-summary-value" id="summary-confidence">‚Äî</div>
          </div>
        </div>
      </div>

      <!-- TEV History Chart -->
      <div class="section chart-section" id="tev-chart-section">
        <div class="section-title">
          <span class="icon">üìà</span>
          <span data-i18n="section.tevHistory">TEV ÂéÜÂè≤ËÆ∞ÂΩï</span>
        </div>
        <div class="chart-container">
          <div class="chart-canvas-wrap">
            <canvas id="tev-history-chart"></canvas>
          </div>
          <div class="chart-stats" id="chart-stats"></div>
        </div>
      </div>

      <!-- Token Burns Section (BNB/HYPE/UNI) -->
      <div class="section" id="token-burns-section" style="display: none;">
        <div class="section-title">
          <span class="icon">üî•</span>
          <span id="burns-section-title">ÈîÄÊØÅËÆ∞ÂΩï</span>
        </div>
        
        <!-- Progress Bar -->
        <div class="burn-progress-container">
          <div class="burn-progress-header">
            <span data-i18n="burn.progress">ÈîÄÊØÅËøõÂ∫¶</span>
            <span id="burn-progress-text">0 / 100M BNB</span>
          </div>
          <div class="burn-progress-bar">
            <div class="burn-progress-fill" id="burn-progress-fill"></div>
          </div>
          <div class="burn-progress-stats">
            <div class="burn-stat">
              <span class="burn-stat-value" id="burn-total">‚Äî</span>
              <span class="burn-stat-label" data-i18n="burn.totalBurned">Â∑≤ÈîÄÊØÅ</span>
            </div>
            <div class="burn-stat">
              <span class="burn-stat-value" id="burn-remaining">‚Äî</span>
              <span class="burn-stat-label" data-i18n="burn.remaining">Ââ©‰Ωô‰æõÂ∫î</span>
            </div>
            <div class="burn-stat">
              <span class="burn-stat-value" id="burn-target">100M</span>
              <span class="burn-stat-label" data-i18n="burn.target">ÁõÆÊ†á‰æõÂ∫î</span>
            </div>
          </div>
        </div>

        <!-- Charts -->
        <div class="burn-charts-grid">
          <div class="burn-chart-card">
            <h4 data-i18n="burn.amountChart">Â≠£Â∫¶ÈîÄÊØÅÊï∞Èáè (BNB)</h4>
            <div class="chart-canvas-wrap">
              <canvas id="burn-amount-chart"></canvas>
            </div>
          </div>
          <div class="burn-chart-card">
            <h4 data-i18n="burn.valueChart">Â≠£Â∫¶ÈîÄÊØÅ‰ª∑ÂÄº (USD)</h4>
            <div class="chart-canvas-wrap">
              <canvas id="burn-value-chart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- TEV Mechanisms -->
      <div class="section">
        <div class="section-title">
          <span class="icon">‚öôÔ∏è</span>
          <span data-i18n="section.tevMechanisms">TEV Êú∫Âà∂ËØ¶ÊÉÖ</span>
        </div>
        <div id="mechanisms-container">
          <!-- Mechanisms will be rendered here -->
        </div>
      </div>

      <!-- Data Sources -->
      <div class="section">
        <div class="section-title">
          <span class="icon">üîó</span>
          <span data-i18n="section.dataSources">Êï∞ÊçÆÊù•Ê∫ê</span>
        </div>
        <div class="sources-list" id="sources-container">
          <!-- Sources will be rendered here -->
        </div>
      </div>

      <!-- Notes -->
      <div class="section" id="notes-section" style="display: none;">
        <div class="section-title">
          <span class="icon">üìù</span>
          <span data-i18n="section.notes">ÂàÜÊûêÂ∏àÂ§áÊ≥®</span>
        </div>
        <div class="protocol-notes" id="protocol-notes"></div>
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div>TEV Dashboard ¬∑ <span data-i18n="footer.lastUpdated">ÊúÄÂêéÊõ¥Êñ∞</span>: <span id="last-updated">‚Äî</span></div>
        <div class="footer-links">
          <a href="https://www.youtube.com/@Crypto36D" target="_blank">YouTube</a>
          <a href="https://x.com/22333D" target="_blank">Twitter</a>
        </div>
      </div>
    </div>
  </footer>

  <script>
    // i18n translations
    const i18n = {
      zh: {
        'nav.dashboard': '‰ª™Ë°®Áõò',
        'loading': 'Âä†ËΩΩ‰∏≠...',
        'section.tevSummary': 'TEV Ê¶ÇËßà',
        'section.tevHistory': 'TEV ÂéÜÂè≤ËÆ∞ÂΩï',
        'section.tevMechanisms': 'TEV Êú∫Âà∂ËØ¶ÊÉÖ',
        'section.dataSources': 'Êï∞ÊçÆÊù•Ê∫ê',
        'section.notes': 'ÂàÜÊûêÂ∏àÂ§áÊ≥®',
        'chart.totalTev': 'Á¥ØËÆ° TEV',
        'chart.records': 'ËÆ∞ÂΩïÊï∞',
        'chart.avgMonthly': 'ÊúàÂùá TEV',
        'chart.period': 'Êï∞ÊçÆÂë®Êúü',
        'chart.cumulative': 'Á¥ØËÆ° TEV',
        'tev.feeSwitch': 'Ë¥πÁî®ÂºÄÂÖ≥',
        'tev.buybacks': 'ÂõûË¥≠',
        'tev.dividends': 'ÂàÜÁ∫¢',
        'tev.burns': 'ÈîÄÊØÅ',
        'tev.confidence': 'ÂèØ‰ø°Â∫¶',
        'footer.lastUpdated': 'ÊúÄÂêéÊõ¥Êñ∞',
        'status.active': 'Ê¥ªË∑É',
        'status.planned': 'ËÆ°Âàí‰∏≠',
        'status.inactive': 'Êú™ÊøÄÊ¥ª',
        'status.ON': 'Â∑≤ÂºÄÂêØ',
        'status.OFF': 'Êú™ÂºÄÂêØ',
        'status.PARTIAL': 'ÈÉ®ÂàÜ',
        'status.NONE': 'Êó†',
        'status.ACTIVE': 'Ê¥ªË∑É',
        'noTev.title': 'ËØ•ÂçèËÆÆÁõÆÂâçÊ≤°Êúâ TEV Êú∫Âà∂',
        'noTev.desc': '‰ª£Â∏Å‰ªÖÁî®‰∫éÊ≤ªÁêÜÔºåÂçèËÆÆÊî∂ÂÖ•Êú™ÂàÜÈÖçÁªô‰ª£Â∏ÅÊåÅÊúâËÄÖ',
        'mechanism.type.buyback': 'ÂõûË¥≠',
        'mechanism.type.buyback_burn': 'ÂõûË¥≠ÈîÄÊØÅ',
        'mechanism.type.staking_reward': 'Ë¥®ÊäºÂ•ñÂä±',
        'mechanism.type.fee_sharing': 'Ë¥πÁî®ÂàÜÊàê',
        'mechanism.type.ve_distribution': 've ÂàÜÈÖç',
        'mechanism.type.airdrop': 'Á©∫Êäï',
        'source.governance': 'Ê≤ªÁêÜ',
        'source.documentation': 'ÊñáÊ°£',
        'source.report': 'Êä•Âëä',
        'source.api': 'API',
        'section.bnbBurns': 'BNB Â≠£Â∫¶ÈîÄÊØÅËÆ∞ÂΩï',
        'burn.progress': 'ÈîÄÊØÅËøõÂ∫¶',
        'burn.totalBurned': 'Â∑≤ÈîÄÊØÅ',
        'burn.remaining': 'Ââ©‰Ωô‰æõÂ∫î',
        'burn.target': 'ÁõÆÊ†á‰æõÂ∫î',
        'burn.amountChart': 'Â≠£Â∫¶ÈîÄÊØÅÊï∞Èáè (BNB)',
        'burn.valueChart': 'Â≠£Â∫¶ÈîÄÊØÅ‰ª∑ÂÄº (USD)',
        'source.onchain': 'Èìæ‰∏ä',
        'confidence.high': 'È´ò',
        'confidence.medium': '‰∏≠',
        'confidence.low': '‰Ωé',
      },
      en: {
        'nav.dashboard': 'Dashboard',
        'loading': 'Loading...',
        'section.tevSummary': 'TEV Summary',
        'section.tevHistory': 'TEV History',
        'section.tevMechanisms': 'TEV Mechanisms',
        'section.dataSources': 'Data Sources',
        'section.notes': 'Analyst Notes',
        'chart.totalTev': 'Total TEV',
        'chart.records': 'Records',
        'chart.avgMonthly': 'Avg Monthly',
        'chart.period': 'Period',
        'chart.cumulative': 'Cumulative TEV',
        'tev.feeSwitch': 'Fee Switch',
        'tev.buybacks': 'Buybacks',
        'tev.dividends': 'Dividends',
        'tev.burns': 'Burns',
        'tev.confidence': 'Confidence',
        'footer.lastUpdated': 'Last Updated',
        'status.active': 'Active',
        'status.planned': 'Planned',
        'status.inactive': 'Inactive',
        'status.ON': 'ON',
        'status.OFF': 'OFF',
        'status.PARTIAL': 'Partial',
        'status.NONE': 'None',
        'status.ACTIVE': 'Active',
        'noTev.title': 'No TEV Mechanisms',
        'noTev.desc': 'Token is governance-only, protocol revenue not distributed to holders',
        'mechanism.type.buyback': 'Buyback',
        'mechanism.type.buyback_burn': 'Buyback & Burn',
        'mechanism.type.staking_reward': 'Staking Reward',
        'mechanism.type.fee_sharing': 'Fee Sharing',
        'mechanism.type.ve_distribution': 've Distribution',
        'mechanism.type.airdrop': 'Airdrop',
        'source.governance': 'Governance',
        'source.documentation': 'Docs',
        'source.report': 'Report',
        'source.api': 'API',
        'source.onchain': 'On-chain',
        'confidence.high': 'High',
        'confidence.medium': 'Medium',
        'confidence.low': 'Low',
        'section.bnbBurns': 'BNB Quarterly Burns',
        'burn.progress': 'Burn Progress',
        'burn.totalBurned': 'Total Burned',
        'burn.remaining': 'Remaining Supply',
        'burn.target': 'Target Supply',
        'burn.amountChart': 'Quarterly Burn Amount (BNB)',
        'burn.valueChart': 'Quarterly Burn Value (USD)',
      }
    };

    let currentLang = 'zh';

    function t(key) {
      return i18n[currentLang][key] || key;
    }

    function updateI18n() {
      document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        el.textContent = t(key);
      });
    }

    function getProtocolId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id') || 'aave';
    }

    function getTevStatusClass(summary) {
      if (summary.fee_switch === 'ON' || summary.buybacks === 'ACTIVE' || summary.dividends === 'ACTIVE') {
        return 'active';
      } else if (summary.fee_switch === 'PARTIAL' || summary.dividends === 'PARTIAL') {
        return 'partial';
      }
      return 'none';
    }

    function getBadgeClass(status) {
      const statusLower = status?.toLowerCase() || 'none';
      if (statusLower === 'on' || statusLower === 'active') return 'badge-active';
      if (statusLower === 'partial') return 'badge-partial';
      if (statusLower === 'planned') return 'badge-planned';
      return 'badge-none';
    }

    function getValueClass(value) {
      const v = value?.toUpperCase() || 'NONE';
      if (v === 'ON' || v === 'ACTIVE') return 'value-on';
      if (v === 'PARTIAL') return 'value-partial';
      if (v === 'OFF' || v === 'NONE') return 'value-off';
      return 'value-none';
    }

    function renderMechanisms(mechanisms) {
      const container = document.getElementById('mechanisms-container');
      
      if (!mechanisms || mechanisms.length === 0) {
        container.innerHTML = `
          <div class="no-tev-notice">
            <div class="icon">‚ùå</div>
            <h3>${t('noTev.title')}</h3>
            <p>${t('noTev.desc')}</p>
          </div>
        `;
        return;
      }

      container.innerHTML = '<div class="mechanism-list">' + mechanisms.map(m => `
        <div class="mechanism-card">
          <div class="mechanism-header">
            <div>
              <div class="mechanism-name">${m.name}</div>
              <div class="mechanism-type">${t('mechanism.type.' + m.type) || m.type}</div>
            </div>
            <span class="mechanism-status status-${m.status}">${t('status.' + m.status) || m.status}</span>
          </div>
          <div class="mechanism-desc">${m.description}</div>
          <div class="mechanism-meta">
            ${m.start_date ? `<span>üìÖ ${m.start_date}</span>` : ''}
            ${m.fee_share_percentage ? `<span>üí∞ ${m.fee_share_percentage}%</span>` : ''}
            ${m.annual_budget_usd ? `<span>üíµ $${(m.annual_budget_usd / 1e6).toFixed(0)}M/year</span>` : ''}
            ${m.source?.url ? `<a href="${m.source.url}" target="_blank">üîó ${m.source.title || 'Source'}</a>` : ''}
          </div>
        </div>
      `).join('') + '</div>';
    }

    function renderSources(sources) {
      const container = document.getElementById('sources-container');
      
      if (!sources || sources.length === 0) {
        container.innerHTML = '<div style="color: var(--text-tertiary); text-align: center; padding: 20px;">No data sources available</div>';
        return;
      }

      container.innerHTML = sources.map(s => `
        <div class="source-item">
          <div>
            <span class="source-name">${s.name}</span>
            <span class="source-type">${t('source.' + s.type) || s.type}</span>
          </div>
          ${s.url ? `<a href="${s.url}" class="source-link" target="_blank">Open ‚Üí</a>` : ''}
        </div>
      `).join('');
    }

    // ‚îÄ‚îÄ TEV History Chart ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

    const TEV_TYPE_COLORS = {
      buyback_burn:        { bg: 'rgba(34, 197, 94, 0.7)',  border: '#22c55e' },
      buyback_accumulate:  { bg: 'rgba(34, 197, 94, 0.5)',  border: '#4ade80' },
      buyback:             { bg: 'rgba(34, 197, 94, 0.6)',  border: '#22c55e' },
      staking_reward:      { bg: 'rgba(59, 130, 246, 0.7)', border: '#3b82f6' },
      direct_distribution: { bg: 'rgba(168, 85, 247, 0.7)', border: '#a855f7' },
      ve_reward:           { bg: 'rgba(245, 158, 11, 0.7)', border: '#f59e0b' },
      fee_sharing:         { bg: 'rgba(236, 72, 153, 0.7)', border: '#ec4899' },
      aggregate:           { bg: 'rgba(99, 102, 241, 0.7)', border: '#6366f1' },
    };
    const DEFAULT_COLOR = { bg: 'rgba(161, 161, 170, 0.5)', border: '#a1a1aa' };

    function getTypeColor(type) {
      return TEV_TYPE_COLORS[type] || DEFAULT_COLOR;
    }

    function getTypeLabel(type) {
      return t('mechanism.type.' + type) || type.replace(/_/g, ' ');
    }

    function formatChartCurrency(value) {
      if (value >= 1e9) return '$' + (value / 1e9).toFixed(2) + 'B';
      if (value >= 1e6) return '$' + (value / 1e6).toFixed(2) + 'M';
      if (value >= 1e3) return '$' + (value / 1e3).toFixed(1) + 'K';
      return '$' + value.toFixed(0);
    }

    let tevChart = null;

    async function loadTevChart(protocolId) {
      const section = document.getElementById('tev-chart-section');
      try {
        const resp = await fetch(`../data/protocols/${protocolId}/tev-records.json`);
        if (!resp.ok) return;
        const data = await resp.json();
        const records = data.records;
        if (!records || records.length === 0) return;

        // Sort by date
        records.sort((a, b) => new Date(a.date) - new Date(b.date));

        // Group by type
        const types = [...new Set(records.map(r => r.type))];

        // Build datasets ‚Äî one bar dataset per type + cumulative line
        const labels = records.map(r => {
          if (r.period) return r.period;
          const d = new Date(r.date);
          return d.toLocaleDateString(currentLang === 'zh' ? 'zh-CN' : 'en-US', { year: 'numeric', month: 'short' });
        });

        const barDatasets = types.map(type => {
          const color = getTypeColor(type);
          return {
            label: getTypeLabel(type),
            data: records.map(r => r.type === type ? r.amount_usd : 0),
            backgroundColor: color.bg,
            borderColor: color.border,
            borderWidth: 1,
            borderRadius: 4,
            type: 'bar',
            yAxisID: 'y',
            order: 2,
          };
        });

        // Cumulative line
        let cumulative = 0;
        const cumulativeData = records.map(r => {
          cumulative += r.amount_usd;
          return cumulative;
        });

        const lineDataset = {
          label: t('chart.cumulative'),
          data: cumulativeData,
          borderColor: '#f59e0b',
          backgroundColor: 'rgba(245, 158, 11, 0.1)',
          borderWidth: 2,
          pointRadius: 3,
          pointHoverRadius: 6,
          pointBackgroundColor: '#f59e0b',
          fill: true,
          type: 'line',
          yAxisID: 'y2',
          tension: 0.3,
          order: 1,
        };

        // Render chart
        const ctx = document.getElementById('tev-history-chart').getContext('2d');
        if (tevChart) tevChart.destroy();

        tevChart = new Chart(ctx, {
          data: {
            labels,
            datasets: [...barDatasets, lineDataset],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              mode: 'index',
              intersect: false,
            },
            plugins: {
              legend: {
                display: true,
                position: 'top',
                labels: {
                  color: '#a1a1aa',
                  font: { size: 11 },
                  boxWidth: 12,
                  boxHeight: 12,
                  borderRadius: 3,
                  useBorderRadius: true,
                  padding: 16,
                },
              },
              tooltip: {
                backgroundColor: '#18181b',
                titleColor: '#fafafa',
                bodyColor: '#a1a1aa',
                borderColor: '#27272a',
                borderWidth: 1,
                padding: 12,
                displayColors: true,
                callbacks: {
                  label: function(ctx) {
                    if (ctx.raw === 0) return null;
                    return ` ${ctx.dataset.label}: ${formatChartCurrency(ctx.raw)}`;
                  },
                  title: function(items) {
                    const idx = items[0].dataIndex;
                    const record = records[idx];
                    let title = items[0].label;
                    if (record.mechanism) title += ' ¬∑ ' + record.mechanism;
                    return title;
                  },
                },
                filter: function(item) {
                  return item.raw !== 0;
                },
              },
            },
            scales: {
              x: {
                grid: { color: 'rgba(39, 39, 42, 0.5)', drawBorder: false },
                ticks: { color: '#71717a', font: { size: 11 } },
              },
              y: {
                position: 'left',
                grid: { color: 'rgba(39, 39, 42, 0.5)', drawBorder: false },
                ticks: {
                  color: '#71717a',
                  font: { size: 11 },
                  callback: v => formatChartCurrency(v),
                },
                title: {
                  display: true,
                  text: currentLang === 'zh' ? 'ÂçïÊúü TEV (USD)' : 'Period TEV (USD)',
                  color: '#71717a',
                  font: { size: 11 },
                },
              },
              y2: {
                position: 'right',
                grid: { display: false },
                ticks: {
                  color: '#f59e0b',
                  font: { size: 11 },
                  callback: v => formatChartCurrency(v),
                },
                title: {
                  display: true,
                  text: t('chart.cumulative') + ' (USD)',
                  color: '#f59e0b',
                  font: { size: 11 },
                },
              },
            },
          },
        });

        // Stats below chart
        const total = records.reduce((s, r) => s + r.amount_usd, 0);
        const avgMonthly = total / records.length;
        const firstDate = records[0].period || records[0].date;
        const lastDate = records[records.length - 1].period || records[records.length - 1].date;

        document.getElementById('chart-stats').innerHTML = `
          <div class="chart-stat">
            <div class="chart-stat-value">${formatChartCurrency(total)}</div>
            <div class="chart-stat-label">${t('chart.totalTev')}</div>
          </div>
          <div class="chart-stat">
            <div class="chart-stat-value">${records.length}</div>
            <div class="chart-stat-label">${t('chart.records')}</div>
          </div>
          <div class="chart-stat">
            <div class="chart-stat-value">${formatChartCurrency(avgMonthly)}</div>
            <div class="chart-stat-label">${t('chart.avgMonthly')}</div>
          </div>
          <div class="chart-stat">
            <div class="chart-stat-value">${firstDate} ‚Üí ${lastDate}</div>
            <div class="chart-stat-label">${t('chart.period')}</div>
          </div>
        `;

        // Show section
        section.classList.add('has-data');
      } catch (e) {
        console.log('No TEV records for chart:', e.message);
      }
    }

    // Token Burns Chart (supports BNB, HYPE, UNI)
    let burnAmountChart = null;
    let burnValueChart = null;

    const BURN_CONFIG = {
      bnb: {
        file: 'bnb-burns.json',
        ticker: 'BNB',
        color: 'rgba(240, 185, 11, 0.8)',
        borderColor: '#f0b90b',
        title: { zh: 'BNB Â≠£Â∫¶ÈîÄÊØÅËÆ∞ÂΩï', en: 'BNB Quarterly Burns' },
        dataType: 'quarterly', // quarterly_burns
        initialSupply: 200000000,
        targetSupply: 100000000
      },
      hype: {
        file: 'hype-burns.json',
        ticker: 'HYPE',
        color: 'rgba(59, 130, 246, 0.8)',
        borderColor: '#3b82f6',
        title: { zh: 'HYPE ÊúàÂ∫¶ÈîÄÊØÅËÆ∞ÂΩï', en: 'HYPE Monthly Burns' },
        dataType: 'monthly' // monthly_burns
      },
      uniswap: {
        file: 'uni-burns.json',
        ticker: 'UNI',
        color: 'rgba(255, 0, 122, 0.8)',
        borderColor: '#ff007a',
        title: { zh: 'UNI ÊúàÂ∫¶ÈîÄÊØÅËÆ∞ÂΩï', en: 'UNI Monthly Burns' },
        dataType: 'monthly' // monthly_burns
      }
    };

    async function loadTokenBurnsChart(protocolId) {
      const config = BURN_CONFIG[protocolId];
      if (!config) return;

      try {
        const response = await fetch(`../data/${config.file}`);
        if (!response.ok) return;
        const data = await response.json();

        // Show section and set title
        document.getElementById('token-burns-section').style.display = 'block';
        document.getElementById('burns-section-title').textContent = 
          currentLang === 'zh' ? config.title.zh : config.title.en;

        // Progress bar
        const totalBurned = data.total_burned;
        const totalSupply = data.total_supply || config.initialSupply || 1000000000;
        const targetSupply = config.targetSupply || data.target_supply;
        
        let progress, burnTarget, progressText;
        if (targetSupply) {
          // BNB style: burn towards target supply
          const initialSupply = config.initialSupply || totalSupply;
          burnTarget = initialSupply - targetSupply;
          progress = (totalBurned / burnTarget) * 100;
          progressText = `${(totalBurned / 1e6).toFixed(2)}M / ${(burnTarget / 1e6).toFixed(0)}M ${config.ticker}`;
        } else {
          // HYPE/UNI style: percentage of total supply
          progress = (totalBurned / totalSupply) * 100;
          progressText = `${(totalBurned / 1e6).toFixed(2)}M ${config.ticker} (${progress.toFixed(2)}%)`;
        }

        document.getElementById('burn-progress-fill').style.width = `${Math.min(progress, 100)}%`;
        document.getElementById('burn-progress-fill').style.background = `linear-gradient(90deg, ${config.borderColor} 0%, ${config.color} 100%)`;
        document.getElementById('burn-progress-fill').textContent = `${progress.toFixed(1)}%`;
        document.getElementById('burn-progress-text').textContent = progressText;
        document.getElementById('burn-total').textContent = `${(totalBurned / 1e6).toFixed(2)}M ${config.ticker}`;
        
        const remaining = data.current_supply || data.circulating_supply || (totalSupply - totalBurned);
        document.getElementById('burn-remaining').textContent = `${(remaining / 1e6).toFixed(2)}M ${config.ticker}`;
        document.getElementById('burn-target').textContent = targetSupply 
          ? `${(targetSupply / 1e6).toFixed(0)}M ${config.ticker}`
          : `${(totalSupply / 1e6).toFixed(0)}M ${config.ticker}`;

        // Get burn records
        let burns, labels, amounts, values;
        if (config.dataType === 'quarterly') {
          burns = (data.quarterly_burns || []).filter(b => !b.note || !b.note.includes('‰º∞ÁÆó'));
          labels = burns.map(b => b.quarter);
          amounts = burns.map(b => b.amount);
          values = burns.map(b => b.value_usd);
        } else {
          burns = data.monthly_burns || [];
          labels = burns.map(b => b.month);
          amounts = burns.map(b => b.amount);
          values = burns.map(b => b.value_usd);
        }

        if (burns.length === 0) {
          console.log('No burn records found');
          return;
        }

        // Amount Chart (Bar)
        const amountCtx = document.getElementById('burn-amount-chart').getContext('2d');
        if (burnAmountChart) burnAmountChart.destroy();
        
        burnAmountChart = new Chart(amountCtx, {
          type: 'bar',
          data: {
            labels,
            datasets: [{
              label: config.ticker,
              data: amounts,
              backgroundColor: config.color,
              borderColor: config.borderColor,
              borderWidth: 1,
              borderRadius: 4,
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: '#18181b',
                titleColor: '#fafafa',
                bodyColor: '#a1a1aa',
                borderColor: '#27272a',
                borderWidth: 1,
                callbacks: {
                  label: ctx => ` ${ctx.raw.toLocaleString()} ${config.ticker}`
                }
              }
            },
            scales: {
              x: {
                grid: { color: 'rgba(39, 39, 42, 0.5)', drawBorder: false },
                ticks: { color: '#71717a', font: { size: 10 }, maxRotation: 45 }
              },
              y: {
                grid: { color: 'rgba(39, 39, 42, 0.5)', drawBorder: false },
                ticks: {
                  color: '#71717a',
                  font: { size: 10 },
                  callback: v => (v / 1e6).toFixed(1) + 'M'
                }
              }
            }
          }
        });

        // Value Chart (Line)
        const valueCtx = document.getElementById('burn-value-chart').getContext('2d');
        if (burnValueChart) burnValueChart.destroy();
        
        burnValueChart = new Chart(valueCtx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'USD',
              data: values,
              borderColor: '#22c55e',
              backgroundColor: 'rgba(34, 197, 94, 0.1)',
              fill: true,
              tension: 0.3,
              pointRadius: 3,
              pointBackgroundColor: '#22c55e',
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: '#18181b',
                titleColor: '#fafafa',
                bodyColor: '#a1a1aa',
                borderColor: '#27272a',
                borderWidth: 1,
                callbacks: {
                  label: ctx => ` $${(ctx.raw / 1e6).toFixed(1)}M`
                }
              }
            },
            scales: {
              x: {
                grid: { color: 'rgba(39, 39, 42, 0.5)', drawBorder: false },
                ticks: { color: '#71717a', font: { size: 10 }, maxRotation: 45 }
              },
              y: {
                grid: { color: 'rgba(39, 39, 42, 0.5)', drawBorder: false },
                ticks: {
                  color: '#71717a',
                  font: { size: 10 },
                  callback: v => '$' + (v / 1e6).toFixed(0) + 'M'
                }
              }
            }
          }
        });

      } catch (e) {
        console.log(`Failed to load ${protocolId} burns:`, e.message);
      }
    }

    async function init() {
      const protocolId = getProtocolId();

      try {
        // Load logo URLs
        let logoUrls = {};
        try {
          const logoRes = await fetch('../data/logo_urls.json');
          if (logoRes.ok) logoUrls = await logoRes.json();
        } catch (e) {}

        // Load config.json
        const response = await fetch(`../data/protocols/${protocolId}/config.json`);
        if (!response.ok) throw new Error('Protocol not found');
        const config = await response.json();

        // Update page
        document.title = `${config.name} ‚Äî TEV Dashboard`;
        document.getElementById('breadcrumb-name').textContent = config.name;
        
        // Set protocol icon (logo URL or name initial fallback)
        const iconEl = document.getElementById('protocol-icon');
        const logoUrl = logoUrls[protocolId] || (config.icon && config.icon.startsWith('http') ? config.icon : null);
        const fallbackChar = config.name ? config.name.charAt(0) : '?';
        if (logoUrl) {
          iconEl.innerHTML = `<img src="${logoUrl}" alt="${config.ticker}" loading="lazy" onerror="this.style.display='none';this.parentElement.textContent='${fallbackChar}'">`;
        } else {
          iconEl.textContent = fallbackChar;
        }
        document.getElementById('protocol-name').textContent = config.name;
        
        const categoryMap = {
          lending: 'ÂÄüË¥∑',
          dex: 'DEX',
          liquid_staking: 'ÊµÅÂä®ÊÄßË¥®Êäº',
          restaking: 'ÂÜçË¥®Êäº',
          perpetuals: 'Ê∞∏Áª≠ÂêàÁ∫¶',
          yield: 'Êî∂Áõä'
        };
        document.getElementById('protocol-ticker').textContent = 
          `${config.ticker} ¬∑ ${currentLang === 'zh' ? (categoryMap[config.category] || config.category) : config.category}`;

        // TEV Badge
        const badge = document.getElementById('tev-badge');
        const tevStatus = getTevStatusClass(config.tev_summary);
        badge.className = `protocol-badge ${getBadgeClass(tevStatus === 'active' ? 'active' : tevStatus === 'partial' ? 'partial' : 'none')}`;
        badge.textContent = tevStatus === 'active' ? 'TEV Active' : tevStatus === 'partial' ? 'TEV Partial' : 'No TEV';

        // Links
        document.getElementById('link-website').href = config.website || '#';
        document.getElementById('link-docs').href = config.docs || '#';
        document.getElementById('link-coingecko').href = config.token?.coingecko_id 
          ? `https://www.coingecko.com/en/coins/${config.token.coingecko_id}` 
          : '#';

        // TEV Status
        const statusText = document.getElementById('tev-status-text');
        statusText.textContent = tevStatus === 'active' ? 'TEV ACTIVE' : tevStatus === 'partial' ? 'TEV PARTIAL' : 'NO TEV';
        statusText.className = `tev-status ${tevStatus}`;

        // Primary value
        document.getElementById('primary-value').textContent = 
          config.tev_summary?.fee_switch === 'ON' ? '‚úì ON' : 
          config.tev_summary?.fee_switch === 'PARTIAL' ? '~ PARTIAL' : '‚úó OFF';
        document.getElementById('primary-label').textContent = config.tev_summary?.primary_value_accrual || '‚Äî';

        // Summary grid
        const summary = config.tev_summary || {};
        const summaryFeeSwitch = document.getElementById('summary-fee-switch');
        summaryFeeSwitch.textContent = t('status.' + (summary.fee_switch || 'OFF'));
        summaryFeeSwitch.className = `tev-summary-value ${getValueClass(summary.fee_switch)}`;

        const summaryBuybacks = document.getElementById('summary-buybacks');
        summaryBuybacks.textContent = t('status.' + (summary.buybacks || 'NONE'));
        summaryBuybacks.className = `tev-summary-value ${getValueClass(summary.buybacks)}`;

        const summaryDividends = document.getElementById('summary-dividends');
        summaryDividends.textContent = t('status.' + (summary.dividends || 'NONE'));
        summaryDividends.className = `tev-summary-value ${getValueClass(summary.dividends)}`;

        const summaryBurns = document.getElementById('summary-burns');
        summaryBurns.textContent = t('status.' + (summary.burns || 'NONE'));
        summaryBurns.className = `tev-summary-value ${getValueClass(summary.burns)}`;

        const summaryConfidence = document.getElementById('summary-confidence');
        summaryConfidence.textContent = t('confidence.' + (config.confidence || 'medium'));
        summaryConfidence.className = `tev-summary-value ${config.confidence === 'high' ? 'value-on' : config.confidence === 'low' ? 'value-off' : 'value-partial'}`;

        // Mechanisms
        renderMechanisms(config.tev_mechanisms);

        // Sources
        renderSources(config.data_sources);

        // Notes
        if (config.notes) {
          document.getElementById('notes-section').style.display = 'block';
          document.getElementById('protocol-notes').textContent = config.notes;
        }

        // Last updated
        document.getElementById('last-updated').textContent = config.last_updated || '‚Äî';

        // Show content
        document.getElementById('loading').style.display = 'none';
        document.getElementById('content').style.display = 'block';

        // Load TEV history chart (async, non-blocking)
        loadTevChart(protocolId);

        // Load token burns chart (BNB, HYPE, UNI)
        if (['bnb', 'hype', 'uniswap'].includes(protocolId)) {
          loadTokenBurnsChart(protocolId);
        }

      } catch (error) {
        console.error('Failed to load protocol:', error);
        document.getElementById('loading').innerHTML = `
          <div style="color: var(--red);">Failed to load protocol</div>
          <div style="margin-top: 8px; font-size: 12px;">${error.message}</div>
          <div style="margin-top: 16px;"><a href="index.html" style="color: var(--blue);">‚Üê Back to Dashboard</a></div>
        `;
      }
    }

    // Language switch
    document.querySelectorAll('.lang-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentLang = btn.dataset.lang;
        updateI18n();
        init(); // Reload with new language
      });
    });

    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
